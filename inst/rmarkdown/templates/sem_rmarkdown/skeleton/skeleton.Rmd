---
title: "Document Title"
output: 
  html_document:
    code_download: yes
    code_folding: hide
    toc: true
    toc_float:
      collapsed: false
params:
  import.file: ""       # Relative file path to data
  mimic: "lavaan"       # Which software program to mimic for estimating models
  missing: "ML"         # How to deal with missing values: "ML" or "listwise"
  std.lv: TRUE          # For CFAs, default setting whether to set latent variances to 1 or not
  std.ov: FALSE         # Staandardize all observed varialbes?
  se: "standard"        # How to calcualte standard errors: "standard" or "bootstrap"
  bootstrap: 1000       # If se = "bootstrap" how many boostrap samples?
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(error = TRUE, message = FALSE, warning = TRUE)
```

# {.tabset .tabset-pills}

Last updated: `r format(Sys.Date(), "%B %d %Y")`

## Results

### Setup

Required Packages
```{r warning=FALSE}
library(readr)
library(lavaan)
library(psych)
library(semoutput)
library(semPlot)
library(sjPlot)
```


Import Data

Data file: `r params$import.file`
```{r warning=FALSE}
## Import Data
data <- read_csv(params$import.file)
```

lavaan parameters:

mimic = `r params$mimic`

missing = `r params$missing`

std.lv = `r params$std.lv`

std.ov = `r params$std.ov`

se = `r params$se`

bootstrap = `r params$bootstrap`

---

---

### Descriptives 

```{r}
# Prints basic descriptive statistics
sem_descriptives(data)
```

---

### Correlation Matrix

```{r}
# Uses sjPlot to print a nice looking correlation table
sjt.corr(data, na.deletion = "pairwise", digits = 2, triangle = "lower")
```

---

---

### EFA {.tabset .tabset-pills}

```{r}
efa_data <- data
efa_fit <- fa(efa_data, fm = "pa", nfactors = 3, rotate = "varimax")
```

#### Summary Output
```{r}
efa_method(efa_fit)
efa_var(efa_fit)
efa_loadings(efa_fit)
```

#### Diagram Output
```{r}
VSS.scree(efa_data)
fa.diagram(efa_fit)
```

#### Full Output
```{r}
efa_fit
```

----

----

### CFA {.tabset .tabset-pills}

```{r}
# factors is a list of the latent factor names. To be used for printing lavaan output to nice looking tables. Not needed to run actual lavaan model
factors <- c()
# Specify the model parameters. Must be incased within single or double quotes. Can add labels to organize parameter specifications. I provided just some example labels, they are not required though and you can use whatever labels you want. You need to know how lavaan works! See http://lavaan.ugent.be/tutorial/index.html for more information on how to specify the model parameters
model <- '
# latent factors

# correlated errors

# constraints

'
# You might want to specify other arguments. But this is pretty standard. 
#std.lv = TRUE means that the latent factor variances are set to 1. If False, then the path for the first variable on the factor specificed in the model will be set to 1.
fit <- cfa(model = model, data = data, 
           mimic = params$mimic, missing = params$missing, 
           std.lv = params$std.lv, std.ov = params$std.ov,
           se = params$se, bootstrap = params$bootstrap)
```

```{r comment=''}
cat("Model: \n", model)
```


#### Summary Output
```{r}
## This tab will print out summary result tables with the most important information. Fit stats, standardized path values, etc...
sem_sig(fit)
sem_fitmeasures(fit)
sem_factorloadings(fit, standardized = TRUE, ci = "standardized")
sem_factorcor(fit, factors = factors)
sem_factorvar(fit, factors = factors)
sem_rsquared(fit)
```

#### Diagram Output
```{r}
## This tab will print out a model diagram. Pretty freak'n cool!
semPaths(fit, latents = factors, whatLabels = "std", layout = "tree2", 
         rotation = 2, style = "lisrel", optimizeLatRes = TRUE, 
         intercepts = FALSE, residuals = TRUE, curve = 1, curvature = 3, 
         sizeLat = 10, nCharNodes = 8, sizeMan = 11, sizeMan2 = 4, 
         edge.label.cex = 1.2, edge.color = "#000000")
## If you want to modify the plot see ?semPlot::semPaths for argument descriptions
```

#### Residual Correlation Matrix
```{r}
## If you want to see the residual correlation matrix
sem_residuals(fit)
```


#### Full Output

##### Summary
```{r}
summary(fit, fit.measures = TRUE, standardized = TRUE)
```

##### Parameter Estimates
```{r}
standardizedSolution(fit)
```


##### Modification Indices
```{r}
modificationIndices(fit, sort. = TRUE, minimum.value = 3)
```

---

---

### SEM {.tabset .tabset-pills}

```{r}
# factors is a list of the latent factor names. To be used for printing lavaan output to nice looking tables. Not needed to run actual lavaan model
factors <- c()
# Specify the model parameters. Must be incased within single or double quotes. Can add labels to organize parameter specifications. I provided just some example labels, they are not required though and you can use whatever labels you want. You need to know how lavaan works! See http://lavaan.ugent.be/tutorial/index.html for more information on how to specify the model parameters
model <- '
# latent factors


# variances


# covariances


# regressions

'
# You might want to specify other arguments. But this is pretty standard. 
#std.lv = TRUE means that the latent factor variances are set to 1. If False, then the path for the first variable on the factor specificed in the model will be set to 1. For an SEM, it is better to set as FALSE. And if you want a latent factor variance set to 1 then specify it in the model and include NA* before the first variable on the factor. See http://lavaan.ugent.be/tutorial/index.html for more details
fit <- sem(model = model, data = data, 
           mimic = params$mimic, missing = params$missing, 
           std.lv = FALSE, std.ov = params$std.ov,
           se = params$se, bootstrap = params$bootstrap)
```

```{r comment=''}
cat("Model: \n", model)
```


#### Summary Output
```{r}
## This tab will print out summary result tables with the most important information. Fit stats, standardized path values, etc...
sem_sig(fit)
sem_fitmeasures(fit)
sem_factorloadings(fit, standardized = TRUE, ci = "standardized")
sem_paths(fit, standardized = TRUE, ci = "standardized")
sem_factorcor(fit, factors = factors)
sem_factorvar(fit, factors = factors)
sem_rsquared(fit)
```

#### Diagram Output
```{r}
## This tab will print out a model diagram. Pretty freak'n cool!
semPaths(fit, latents = factors, whatLabels = "std", layout = "tree2", 
         rotation = 2, style = "lisrel", optimizeLatRes = TRUE, 
         intercepts = FALSE, residuals = TRUE, curve = 1, curvature = 3, 
         sizeLat = 10, nCharNodes = 8, sizeMan = 11, sizeMan2 = 4, 
         edge.label.cex = 1.2, edge.color = "#000000")
## If you want to modify the plot see ?semPlot::semPaths for argument descriptions
```

#### Residual Correlation Matrix
```{r}
## If you want to see the residual correlation matrix
sem_residuals(fit)
```


#### Full Output

##### Summary
```{r}
summary(fit, fit.measures = TRUE, standardized = TRUE)
```

##### Parameter Estimates
```{r}
standardizedSolution(fit)
```


##### Modification Indices
```{r}
modificationIndices(fit, sort. = TRUE, minimum.value = 3)
```

---

---

## Session Info
```{r comment=""}
citation("lavaan")
citation()
sessionInfo()
```
